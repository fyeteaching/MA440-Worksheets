\usepackage{geometry}
\geometry{
    letterpaper,
    margin=0.8in,
    % left=0.8in,
    % top=0.8in,
    % headsep=\baselineskip,
    % textwidth=26pc,
    % marginparsep=2pc,
    % marginparwidth=12pc,
    % textheight=38\baselineskip,
    % headheight=2\baselineskip,
    % includemp,
    % reversemarginpar,
    % bindingoffset=1cm,
    twoside,
    asymmetric
}

\usepackage{amsmath}
% \usepackage{amsthm}

% \usepackage{libertine}  %%%%%The Linux Libertine font family
% \usepackage[libertine]{newtxmath}

\usepackage{comicneue}
% \usepackage{noto-serif}
\usepackage[default]{lato}
\usepackage{libertinust1math}

\usepackage{pifont,manfnt,bbding}

\usepackage[T1]{fontenc}
\usepackage[protrusion=true,expansion=true]{microtype}

\usepackage{datetime}
\newdateformat{mydate}{\monthname[\THEMONTH], \THEYEAR}

\newdateformat{lastupdated}
{\THEMONTH/\THEDAY/\THEYEAR}

\newdateformat{semester}{
  \ifthenelse{\THEMONTH=1}{Winter \THEYEAR}{
    \ifthenelse{\THEMONTH<6}{Spring \THEYEAR}{
      \ifthenelse{\THEMONTH>8}{Fall \THEYEAR}{
        Summer \THEYEAR
      }
    }
  }
}

\usepackage{titling}

\renewcommand{\sectionmark}[1]{ \markright{#1}{} }

\usepackage{fancyhdr}
\pagestyle{fancy}

\fancyhf{}
% \fancyhfoffset[L]{14pc}
\setlength{\headheight}{18.0pt}
\addtolength{\topmargin}{-6.0pt}

\renewcommand{\headrulewidth}{1pt}
% \renewcommand{\footrulewidth}{1pt}
\fancyhead[RE,LO]{\bf \course}
% \fancyhead[RO,LE]{\thepage}
\fancyhead[C]{\large\bf Topic \leftmark}
% \fancyfoot[RE, LO]{\raisebox{-10\baselineskip}{\semester{\thedate}}}
% \fancyfoot[RO, LE]{\raisebox{-10\baselineskip}{\hfill \sffamily \theauthor}\hspace{-1ex}}
% \fancyfoot[C]{\raisebox{-10\baselineskip}{\thepage}}
\fancyfoot[C]{\thepage}

% \usepackage{ifthen}
% \usepackage{xparse}
\usepackage{ifoddpage}

% \usepackage{eso-pic}

% \NewDocumentCommand{\addBG}{}{
%   \AddToShipoutPicture{
%     \AtTextLowerLeft{
%       \put(-1pc,\LenToUnit{-\baselineskip}){
%         \rule[0em]{1.5pt}{\dimexpr \textheight+2\baselineskip}
%       }
%     }
%   }
% }

\NewDocumentCommand{\newlecture}{}{
  \newpage
  \checkoddpage
  \ifoddpage
  \else
    \clearpage
    \thispagestyle{empty}
    % \ClearShipoutPictureBG
    \cleardoublepage
    \newpage
    % \addBG
  \fi
}

\usepackage{graphicx}
\usepackage[
  breaklinks = true,
  colorlinks = true,
  pdftitle = "MA440 Worksheets",
  pdfauthor = "Dr. Ye"
]{hyperref}
\usepackage{bookmark}
\usepackage{longtable}
\usepackage{calc}
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{tabularx}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage[svgnames]{xcolor}

% \usepackage{changepage}

% \newenvironment{fullwidth}{%
%   \begin{adjustwidth}{-14pc}{}%
%   \hsize=\linewidth%
% }{
%   \end{adjustwidth}
% }

\usepackage[inline]{enumitem}
\setenumerate{
	label=\textup{(\arabic*)},
	% afterlabel={\quad},
	%%vertical
	topsep=0pt,
	partopsep=0pt,
	% itemsep=6\baselineskip,
	parsep=2pt,
  % after=\vspace*{\dimexpr 6\baselineskip},
	% labelindent=0em,
	% itemindent = *,
	% itemindent=1ex,
	% wide,
	% itemjoin={\hspace{0.1\textwidth}},
	%%Horizontal
}
\setitemize{
	%%vertical
	topsep=0pt,
	partopsep=0pt,
	itemsep=0pt,
	parsep=0pt,
	%%Horizontal
	labelindent=0em,
	leftmargin =!,
	itemindent = 0pt,
	labelsep= 2pt,
	labelwidth=1em,
}
\setlist{topsep=0pt}

\SetEnumitemKey{sepno}{nosep, after=\vspace*{0pt}}

\SetEnumitemKey{twocol}{
itemsep = 1\itemsep,
parsep = 1\parsep,
before = \raggedcolumns\begin{multicols}{2},
after = \end{multicols}}

\SetEnumitemKey{threecol}{
itemsep = 1\itemsep,
parsep = 1\parsep,
before = \raggedcolumns\begin{multicols}{3},
after = \end{multicols}}

\SetEnumitemKey{fourcol}{
itemsep = 1\itemsep,
parsep = 1\parsep,
before = \raggedcolumns\begin{multicols}{4},
after = \end{multicols}}

\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepackage{pgfmath}
\usepackage{tikz-cd}
\usepackage{pgffor}
\usepackage{tkz-euclide}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{
    calc,
    angles,
    quotes,
    arrows.meta,
    math,
    backgrounds,
    pgfplots.statistics,
    matrix,
    patterns,
    shapes.geometric,
    spy,
    intersections,
    decorations.markings,
    decorations.pathmorphing,
    decorations.pathreplacing,
    decorations.shapes
}
\pgfdeclarelayer{ft}
\pgfdeclarelayer{bg}
\pgfsetlayers{bg,main,ft}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%% Setup the Coordinate System %%%%%%%%%%%%%%%%%%%%%%
\pgfplotsset{
    every axis/.style={
        %		 axis equal image,
        axis x line=middle,    % put the x axis in the middle
        axis y line=middle,    % put the y axis in the middle
        axis line style={-latex,very thick}, % arrows on the axis
        xlabel={$x$},          % default put x on x-axis
        ylabel={$y$},          % default put y on y-axis
        xlabel style = {font=\tiny, at={(xticklabel* cs:1)}, anchor=south},
        ylabel style = {font=\tiny, at={(yticklabel* cs:1)}, anchor=west},
        scaled ticks=true,
        x tick label style={font=\tiny, yshift=0.25ex, inner xsep=0pt},
        y tick label style={font=\tiny, xshift=0.25ex, inner ysep=0pt},
        grid style={black},
        % set layers=standard,
    }
}

%%%%%%%%%%%%%%% include files/Figure %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{import}
% \usepackage{subfiles}
\usepackage{wrapfig}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%% Cancel common factors in Math %%%%%%%%%%%%%%%%%%%%
\usepackage[makeroom]{cancel}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%% Math mode without vertical spacing %%%%%%%%%%%%%%%%%
\makeatletter
\g@addto@macro\normalsize{%
    \setlength\abovedisplayskip{1pt plus 2pt minus 2pt}%
    \setlength\belowdisplayskip{1pt plus 2pt minus 2pt}%
    \setlength\abovedisplayshortskip{1pt plus 2pt minus 2pt}%
    \setlength\belowdisplayshortskip{1pt plus 2pt minus 2pt}%
}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\ZZ}{\mathbf{Z}}
\newcommand{\RR}{\mathbf{R}}
\newcommand{\NN}{\mathbf{N}}
\newcommand{\QQ}{\mathbf{Q}}
\newcommand{\abs}[1]{\lvert #1\rvert}
\newcommand{\ii}{\mathbf{i}}
\newcommand{\parll}{ {\mathbin{\parallel}} }
\newcommand{\prll}{{\mathbin{\!/\mkern-5mu/\!}}}

\makeatletter
\renewcommand*\rel@kern[1]{\kern#1\dimexpr\macc@kerna}
\renewcommand*\widebar[1]{%
\begingroup
\def\mathaccent##1##2{%
\rel@kern{0.8}%
\overline{\rel@kern{-0.8}\macc@nucleus\rel@kern{0.2}}%
\rel@kern{-0.2}%
}%
\macc@depth\@ne
\let\math@bgroup\@empty \let\math@egroup\macc@set@skewchar
\mathsurround\z@ \frozen@everymath{\mathgroup\macc@group\relax}%
\macc@set@skewchar\relax
\let\mathaccentV\macc@nested@a
\macc@nested@a\relax111{#1}%
\endgroup
}
\renewcommand{\bar}{\widebar}
\newcommand*\centermath[1]{\omit\hfil~$\displaystyle#1$~\hfil\ignorespaces}
\newcommand{\cmc}{\centermath}
\newcommand*\ctc[1]{\omit\hfil\quad~ #1 ~\quad\hfil\ignorespaces}
\newcommand{\dfn}[1]{\textit{\textbf{#1}}}


%%%% Define Theorem Environment. Codes are modified from the Elegantbook class.

\usepackage[most]{tcolorbox}
\tcbuselibrary{theorems, hooks}

\newcommand{\proofname}{Proof}
\newcommand{\definitionname}{Definition}
\newcommand{\theoremname}{Theorem}
\newcommand{\lemmaname}{Lemma}
\newcommand{\propositionname}{Proposition}
\newcommand{\corollaryname}{Corollary}
\newcommand{\examplename}{Example}
\newcommand{\exercisename}{Exercise}
\newcommand{\remarkname}{Remark}
\newcommand{\solutionname}{Solution}

\newcommand{\thmcnt}{section}

\newlength{\normalparindent}
\setlength{\normalparindent}{\parindent}

\tcbset{
  common/.style={
    enhanced,
    breakable,
    % frame hidden,
    % opacityframe=.6,
    colback=white,
    coltitle=blue!90,
    grow to left by=1em,
    grow to right by=1em,
    left*=0pt,
    right*=0pt,
    boxrule=1pt,
    titlerule=0mm,
    % theorem hanging indent=0pt,
    arc=5pt,
    fonttitle=\upshape\bfseries,
    theorem style=plain,
    before upper app={\setlength{\parindent}{\normalparindent}},
    % adjusted title=left,
    % halign title=left,
    },
  defstyle/.style={
    % colback=green!10!white,
    colframe=green!80!black,
  },
  theostyle/.style={
    fontupper=\itshape,
    % colback=red!10!white,
    colframe=red!75!black
  },
  exmstyle/.style={
    frame hidden,
    % borderline east={1pt}{0pt}{blue!75!black},
    % overlay unbroken and last={%
    %     \draw[line width=1pt, blue!75!black, yshift=12pt] (frame.south east)   -- ++(0:-4cm);},
    colback=blue!5!white,
    % colframe=blue!75!black
    after app={\vspace*{8\baselineskip}}
  },
  ELEGANTtitle/.code n args={2}
    {
      \tcbset
        {
          title=
            {\csname #1name\endcsname~%
              \ifdef{\thetcbcounter}{\thetcbcounter}{}%
              \ifblank{#2}{}{\ (#2)}
            }
        }
    },
  % #1 is the command name of the theorem environment
  % #2 is the name of the theorem
  ELEGANTlabel/.code n args={2}
    {
      \ifblank{#2}
        {}{\tcbset{label={#1:#2}}}
    }
}


\NewDocumentCommand \ELEGANTnewtheorem { m m m O{}  }{
  \expandafter\ifblank\expandafter{#4}{
      \tcbset{
        new/usecnt/.style={}
      }
    }{
      \tcbset{
        new/usecnt/.style= {#4}
      }
    }
    \DeclareTColorBox[auto counter,number within=\thmcnt, usecnt]{#1}{ g o t\label g }{ % #1 is the command name of the theorem environment
    parskip, common, #3,
        % #3 is the thmstyle
        IfValueTF={##1}
          {ELEGANTtitle={#1}{##1}}
          {
            IfValueTF={##2}
            {ELEGANTtitle={#1}{##2}}
            {ELEGANTtitle={#1}{}}
          },
          % ##1 is the name of the theorem in tcolorbox format.
          % ##2 is the name of the theorem in amsthm format
        IfValueT={##4}
          { % ##4 is the label in tcolorbox format or the actual label in the command \label{}.
            IfBooleanTF={##3} % ##3 is value if \label{} is used.
              {ELEGANTlabel={##4}}
              {ELEGANTlabel={#2}{##4}}
          }
      }
    \DeclareTColorBox{#1*}{ g o }{
      parskip, common,#3,
        IfValueTF={##1}
          {ELEGANTtitle={#1}{##1}}
          {
            IfValueTF={##2}
            {ELEGANTtitle={#1}{##2}}
            {ELEGANTtitle={#1}{}}
          },
      }
  }

\ELEGANTnewtheorem{definition}{def}{defstyle}

\ELEGANTnewtheorem{theorem}{thm}{theostyle}[use counter from = definition]%

\ELEGANTnewtheorem{proposition}{prp}{theostyle}[use counter from = definition]%

\ELEGANTnewtheorem{lemma}{lem}{theostyle}[use counter from = definition]%

\ELEGANTnewtheorem{corollary}{cor}{theostyle}[use counter from = definition]%

\ELEGANTnewtheorem{example}{exm}{exmstyle}

\ELEGANTnewtheorem{solution}{}{exmstyle}[no counter]

\ELEGANTnewtheorem{proof}{}{exmstyle}[no counter]

\ELEGANTnewtheorem{remark}{}{defstyle}[no counter]

\newcounter{exer}[section]
\setcounter{exer}{0}
\renewcommand{\theexer}{\thesection.\arabic{exer}}

\newenvironment{exercise}[1][]{
  \refstepcounter{exer}
  \par\noindent\makebox[-3pt][r]{
    \footnotesize\color{red!90}\HandPencilLeft\quad}
    \comicneueangular
    \textbf{\color{blue!90}{\exercisename} \theexer ~~ #1}}{\vspace*{8\baselineskip}
    \par\ignorespacesafterend}
